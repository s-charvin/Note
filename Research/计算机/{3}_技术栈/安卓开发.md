---
excalidraw-plugin: parsed
tags: null
title: 安卓开发
description: ''
author: ''
categories: ''
keywords:
  - ''
draft: true
layout: ''
date: 2024-07-31 10:44:21
lastmod: 2024-08-05 09:05:38
---

## Android 应用程序组成

### 清单文件 `AndroidManifest.xml`

安卓操作系统与安卓应用程序之间由清单文件 `AndroidManifest.xml` 进行连接, 该清单文件位于应用程序的根目录下, 用于描述应用程序的基本信息, 如应用程序的名称、图标、版本号、权限等. 以下是一个简单的清单文件示例及其内容解析:

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">

    <!-- 应用程序信息 -->
    <application
        android:allowBackup="true"
        android:dataExtractionRules="@xml/data_extraction_rules"
        android:fullBackupContent="@xml/backup_rules"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/Theme.MyApplication3"
        tools:targetApi="31">

        <!-- 活动声明 -->
        <activity
            android:name=".MainActivity"
            android:launchMode="singleTop"
            android:taskAffinity=""
            android:allowTaskReparenting="true"
            android:exported="true"
            android:label="@string/title_activity_main">
        <intent-filter>
            <action android:name="android.intent.action.MAIN" />
            <category android:name="android.intent.category.LAUNCHER" />
        </intent-filter>
        </activity>

        <activity
            android:name=".SecondActivity"
            android:exported="true"
            android:label="@string/title_activity_second">
        <intent-filter>
            <action android:name="com.example.SECOND" />
            <category android:name="android.intent.category.DEFAULT" />
        </intent-filter>
        </activity>

        <!-- 服务声明 -->
        <service
            android:name=".MyService"
            android:exported="true">
            <intent-filter>
                <action android:name="com.example.MY_SERVICE" />
            </intent-filter>
        </service>

        <!-- 广播接收器声明 -->
        <receiver
            android:name=".MyReceiver"
            android:exported="true">
            <intent-filter>
                <action android:name="android.intent.action.BOOT_COMPLETED" />
            </intent-filter>
        </receiver>

        <!-- 内容提供程序声明 -->
        <provider
            android:name=".MyProvider"
            android:authorities="com.example.myprovider"
            android:exported="true"
            android:grantUriPermissions="true">
            <grant-uri-permission android:pathPattern="/myprovider/*" />
            </provider>
    </application>

    <!-- 权限声明 -->
    <uses-permission android:name="android.permission.INTERNET" />
    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
    <uses-permission android:name="android.permission.CAMERA" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION" />

    <!-- 使用特性 -->
    <uses-feature android:name="android.hardware.camera" />
    <uses-feature android:name="android.hardware.microphone" />
    <uses-feature android:name="android.hardware.location.gps" />

</manifest>
```

**顶部声明**
- `<?xml version="1.0" encoding="utf-8"?>`：声明 XML 文件的版本和编码方式。
- `<manifest>`：根元素，包含应用的所有配置。
    - `xmlns:android="http://schemas.android.com/apk/res/android"`：定义 `android` 命名空间，用于引用安卓系统提供的属性。
    - `xmlns:tools="http://schemas.android.com/tools"`：定义 `tools` 命名空间，用于引用开发工具（如 Android Studio）提供的一些自定义属性。
**`<application>` 元素**

包含应用级别的配置信息，定义应用的全局属性和组件。
- `android:allowBackup="true"`: 允许用户备份和恢复应用的数据。
- `android:dataExtractionRules="@xml/data_extraction_rules"`: 指定数据提取规则，通常用于自动备份功能。
- `android:fullBackupContent="@xml/backup_rules"`: 指定完整备份内容的规则。
- `android:icon="@mipmap/ic_launcher"`: 指定应用图标。
- `android:label="@string/app_name"`: 指定应用的显示名称。
- `android:roundIcon="@mipmap/ic_launcher_round"`: 指定圆形应用图标（通常用于圆形图标需求的设备）。
- `android:supportsRtl="true"`: 指定应用是否支持从右到左（RTL）的布局方向。
- `android:theme="@style/Theme.MyApplication3"`: 指定应用的主题。
- `tools:targetApi="31"`: 指定目标 API 级别，主要用于开发工具进行静态代码检查，不影响实际运行时的行为。

**`<activity>` 元素**

定义一个活动（Activity），是应用的一个主要组件，代表一个用户界面。
- `android:name=".MainActivity"`: 指定活动的类名，`.MainActivity` 表示该活动在应用包名下。
- `android:launchMode="singleTop"`: 指定活动的启动模式。这里是 `singleTop`，表示如果活动已经在栈顶，不会重新创建新的实例。
- `android:taskAffinity=""`: 指定活动的任务亲和性。
- `android:allowTaskReparenting="true"`: 指定活动是否允许移动到其他任务中。
- `android:exported="true"`: 指定活动是否可以由应用之外的组件启动。`true` 表示可以被其他应用访问。
- `android:label="@string/title_activity_main"`: 指定活动的显示名称。
- `<intent-filter>`: 定义了活动能够响应的意图（Intent），通常用于配置应用的启动活动和处理特定的动作。
    - `<action>`: 定义意图的动作。
        - `android:name="android.intent.action.MAIN"`: 表示该活动是应用的主入口点。
        - `android:name="com.example.SECOND"`: 自定义的动作名称。
    - `<category>`: 定义意图的类别。
        - `android:name="android.intent.category.LAUNCHER"`: 表示该活动会出现在应用启动器中，作为应用的启动活动。
        - `android:name="android.intent.category.DEFAULT"`: 默认的意图类别。

**`<service>` 元素**

定义一个服务（Service），是一个后台运行的组件，用于执行长时间运行的操作。
- `android:name=".MyService"`: 指定服务的类名。
- `android:exported="true"`: 指定服务是否可以被其他应用访问。
- `<intent-filter>`: 定义了服务能够响应的意图。
    - `<action>`: 定义意图的动作。
        - `android:name="com.example.MY_SERVICE"`: 自定义的动作名称。

**`<receiver>` 元素**

定义一个广播接收器（Broadcast Receiver），用于接收系统广播事件。
- `android:name=".MyReceiver"`: 指定广播接收器的类名。
- `android:exported="true"`: 指定广播接收器是否可以被其他应用访问。
- `<intent-filter>`: 定义了广播接收器能够响应的意图。
    - `<action>`: 定义意图的动作。
        - `android:name="android.intent.action.BOOT_COMPLETED"`: 表示系统启动完成后发送的广播。

**`<provider>` 元素**

定义一个内容提供程序（Content Provider），用于管理应用程序的数据集。
- `android:name=".MyProvider"`: 指定内容提供程序的类名。
- `android:authorities="com.example.myprovider"`: 指定内容提供程序的权限。
- `android:exported="true"`: 指定内容提供程序是否可以被其他应用访问。
- `android:grantUriPermissions="true"`: 指定内容提供程序是否授予 URI 权限。
- `<grant-uri-permission>`: 定义了内容提供程序授予的 URI 权限。
    - `android:pathPattern="/myprovider/*"`: 匹配 URI 的路径模式。

**`<uses-permission>` 元素**

定义应用程序需要的权限。
- `android:name="android.permission.INTERNET"`: 访问互联网的权限。
- `android:name="android.permission.ACCESS_NETWORK_STATE"`: 访问网络状态的权限。
- `android:name="android.permission.CAMERA"`: 使用摄像头的权限。
- `android:name="android.permission.RECORD_AUDIO"`: 录制音频的权限。
- `android:name="android.permission.ACCESS_FINE_LOCATION"`: 访问精确位置的权限。

**`<uses-feature>` 元素**

定义应用程序需要的硬件功能。
- `android:name="android.hardware.camera"`: 摄像头硬件功能。
- `android:name="android.hardware.microphone"`: 麦克风硬件功能。
- `android:name="android.hardware.location.gps"`: GPS 定位硬件功能。

### 应用程序四大组件: 活动、服务、广播接收器、内容提供程序

Android 应用程序由四个主要组件组成:
- 活动 (Activity): 用户与应用程序进行交互的主要入口点, 通常表示一个具有用户界面的屏幕
- 服务 (Service): 在后台执行长时间运行的操作或远程处理
- 广播接收器 (Broadcast Receiver): 在系统广播事件发生时接收系统广播
- 内容提供程序 (Content Provider): 管理应用程序的数据集

活动可以启动服务来执行后台任务; 注册广播接收器来接收系统或应用的广播以更新 UI; 使用内容提供程序来访问和管理数据; 启动其他活动，并传递数据。

广播接收器被动接收系统或应用的广播事件, 然后可以启动服务来执行后台任务, 也可以通过内容提供程序来访问和管理数据。

服务通常是由活动或广播接收器启动, 可以通过内容提供程序来访问和管理数据。

内容提供程序为程序提供标准的数据管理接口, 包括查询、插入、更新和删除。

此外还有些附加组件:
- 片段 (Fragment): 可重用的 UI 组件
- 意图 (Intent): 用于在组件之间传递消息
- 视图 (View): 用户界面的构建块
- 布局 (Layout): 定义视图的结构和外观
- 资源 (Resource): 应用程序的非代码资源，如图像、字符串和布局文件

#### 活动 (Activity)

活动是 Android 应用程序的一个主要组件，用于表示用户界面的一个屏幕, 通常包含用户界面元素，如按钮、文本框和图像，用于与用户进行交互。每个活动都是一个类，继承自 `Activity` 类或其子类。Android 系统初始化其应用程序是通过活动中的 `onCreate()` 开始的。

每个应用程序可以包含多个活动，所有活动必须在清单文件 `AndroidManifest.xml` 中进行声明。

每个活动都有一个生命周期，包括以下主要状态:
- `onCreate()`: 活动创建时调用
- `onStart()`: 活动开始时调用
- `onResume()`: 活动恢复时调用
- `onPause()`: 活动暂停时调用
- `onStop()`: 活动停止时调用
- `onDestroy()`: 活动销毁时调用
- `onRestart()`: 活动重新启动时调用

活动之间可以通过意图 (Intent) 进行通信，意图可以用于启动活动、启动服务、发送广播等。

#### 服务 (Service)

服务是可以在后台执行长时间运行操作或远程处理(下载文件、播放音乐、更新数据等)的组件，不提供用户界面, 即使应用程序处于后台或被销毁，服务仍然可以继续运行。每个服务都是一个类，继承自 `Service` 类或其子类。服务必须在清单文件 `AndroidManifest.xml` 中进行声明。

服务可以通过活动的 `startService()` 或 `bindService()` 方法启动，通过 `stopService()` 或 `unbindService()` 方法停止。区别在于 `startService()` 启动的服务会一直运行，直到调用 `stopService()` 停止，而 `bindService()` 启动的服务只有在绑定的活动存在时才会运行。

每个服务也有一个生命周期，包括以下主要状态:
- `onStartCommand()`: 服务启动时调用
- `onCreate()`: 服务创建时调用
- `onBind()`: 服务绑定时调用
- `onUnbind()`: 服务解绑时调用
- `onRebind()`: 服务重新绑定时调用
- `onDestroy()`: 服务销毁时调用

#### 广播接收器 (Broadcast Receiver)

广播接收器是用于接收系统或应用的广播事件的组件，当特定事件发生时，广播接收器会接收并处理广播消息。每个广播接收器都是一个类，继承自 `BroadcastReceiver` 类或其子类。广播接收器必须在清单文件 `AndroidManifest.xml` 中进行声明。

广播接收器可以通过 `registerReceiver()` 方法注册，通过 `unregisterReceiver()` 方法注销。也可以通过清单文件声明静态注册，这样即使应用程序未运行，也可以接收广播。

广播接收器可以接收系统广播事件, 常见的系统广播事件包括:
- `android.intent.action.BOOT_COMPLETED`: 系统启动完成时发送的广播
- `android.intent.action.SCREEN_ON`: 屏幕开启时发送的广播
- `android.intent.action.SCREEN_OFF`: 屏幕关闭时发送的广播
- `android.intent.action.ACTION_POWER_CONNECTED`: 充电器连接时发送的广播
- `android.intent.action.ACTION_POWER_DISCONNECTED`: 充电器断开时发送的广播
- `android.intent.action.BATTERY_LOW`: 电池电量低时发送的广播
- `android.intent.action.BATTERY_OKAY`: 电池电量恢复正常时发送的广播

广播接收器也可以通过活动的`sendBroadcast()` 方法发送自定义的广播事件。

#### 内容提供程序 (Content Provider)

内容提供程序是用于管理应用程序的数据集的组件，提供标准的数据管理接口，包括查询、插入、更新和删除。内容提供程序可以让应用程序之间共享数据，也可以让应用程序访问系统或其他应用程序的数据。

每个内容提供程序都是一个类，继承自 `ContentProvider` 类或其子类。内容提供程序必须在清单文件 `AndroidManifest.xml` 中进行声明。

内容提供程序通过 URI (Uniform Resource Identifier) 来标识数据集，URI 由以下部分组成:`<prefix>://<authority>/<data_type>/<id>`
内容提供程序可以通过 `query()`、`insert()`、`update()` 和 `delete()` 方法来操作数据，也可以通过 `getType()` 方法获取数据的 MIME 类型。

## UI

应用的界面 (UI) 就是您在屏幕上所看到的内容（文本、图片、按钮和许多其他类型的元素）及其在屏幕上的布局方式。

Jetpack Compose 可以使用在项目的 Android 自动生成的 `R` 类中通过资源 ID 访问 Android 项目中定义的资源。
- `painterResource()` 函数会加载可绘制图片资源，并将资源 ID（在本例中为 `R.drawable.androidparty` ）作为实参。
- `stringResource()` 



`onCreate()` 函数中的 [`setContent()`](https://developer.android.com/reference/kotlin/androidx/compose/ui/platform/ComposeView?hl=zh-cn#setContent(kotlin.Function0)) 函数用于通过可组合函数定义布局。


可组合函数 Jetpack Compose 是用于构建 Android 界面的新款工具包。任何标有 `@Composable` 注解的函数都可通过 `setContent()` 函数或其他可组合函数进行调用。该注解可告知 Kotlin 编译器 Jetpack Compose 使用的这个函数会生成 UI。

注解

```kotlin
@Composable
@Preview
```

修饰符 [`Modifier`](https://developer.android.com/reference/kotlin/androidx/compose/ui/Modifier?hl=zh-cn) 用于扩充或修饰可组合项, 如修饰组件的布局。
- 内边距修饰符 (`Modifier.padding`) 在 `Text` 可组合项的周围添加空间。
```
Modifier.padding(
    start = 16.dp,
    top = 16.dp,
    end = 16.dp,
    bottom = 16.dp
)

Modifier
    .padding(16.dp)
    .align(alignment = Alignment.End)
```
- 背景颜色修饰符 `Modifier.background` 


![](https://developer.android.com/static/codelabs/basic-android-kotlin-compose-add-images/img/df69881d07b064d0.gif?hl=zh-cn)



基本标准布局元素是 `Column`、`Row,` 和 `Box`。
- [`Box`](https://developer.android.com/reference/kotlin/androidx/compose/foundation/layout/package-summary?hl=zh-cn#Box(androidx.compose.ui.Modifier,androidx.compose.ui.Alignment,kotlin.Boolean,kotlin.Function1)) 布局是 Compose 中的标准布局元素之一。使用 `Box` 布局可将元素堆叠在一起。`Box` 布局还可用于配置它所包含的元素的特定对齐方式。

应用在某些情况下可能会被翻译成其他语言, 一些固定的 `String` 数据类型可以提取到资源文件中进行管理, 避免硬编码导致无法进行翻译.

@JvmOverloads constructor 用于自动在 java 中生成各种重载的构造函数


[ConstraintLayout之ConstraintSet - enzo的博客](https://enzowyf.github.io/constraintset.html)

// 设置控件尺寸  
// constrainWidth/constrainHeight  
// constrainDefaultWidth/constrainDefaultHeight  
// constrainMaxWidth/constrainMaxHeight  
// constrainMinWidth/constrainMinHeight
  
// 设置控件间直接约束关系  
  
// 控件 start 的某边与 end 的某边对齐, margin 用于设置边与边中间间距  
// connect(int startID, int startSide, int endID, int endSide, int margin)  
// connect(int startID, int startSide, int endID, int endSide)  
  
// 控件 center 置于另两个控件 first 和 second 之间, bias(0~1) 用于设置位置偏移比例  
// center(int centerID, int firstID, int firstSide, int firstMargin, int secondID, int secondSide, int secondMargin, float bias)  
// 控件 center 水平居中于另一个控件 centerID, leftId/rightId 用于设置左右边界控件  
// centerHorizontally(int centerID, int leftId, int leftSide, int leftMargin, int rightId, int rightSide, int rightMargin, float bias)  
  
// 方向: ConstraintSet.TOP/BOTTOM/START/END/LEFT/RIGHT/BASELINE(TextView)  
  
// 控件 viewId 与 toView 水平居中  
// centerHorizontally(int viewId, int toView)  
// 控件 viewId 与 toView 垂直居中  
// centerVertically(int viewId, int toView)  
  
// 修改控件属性  
// setVisibility/setAlpha/setRotation  
// setRotationX/setRotationY  
// setScaleX/setScaleY/setTransformPivot/setTransformPivotX/setTransformPivotY  
// setTranslation/setTranslationX/setTranslationY/setTranslationZ  
// setElevation




RecyclerView ( `RecyclerView` 和 `RecyclerView.LayoutManager` )
- 数据驱动：需要一个数据源来提供要显示的数据, 见 `RecyclerView.Adapter` 和 `RecyclerView.ViewHolder`
- 可重用性：支持视图的重用机制，通过重用池来减少内存开销, 见 `onCreateViewHolder` 和 `onBindViewHolder`
- 布局管理：支持多种布局，通过不同的布局管理器来控制视图的显示方式（如网格、列表等）, 见 `LinearLayoutManager` 、 `GridLayoutManager` 、 `StaggeredGridLayoutManager`
- 自定义单元格：允许自定义单元格，以便显示复杂的内容。创建自定义的 `ViewHolder` 子类, 然后在 `Adapter` 中使用这个 `ViewHolder`, 在 `onCreateViewHolder` 和 `onBindViewHolder` 方法中绑定 `ViewHolder`.
